<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App</title>
</head>
<body>
    <h1>Todo App</h1>

    <!-- Formulário para adicionar uma nova tarefa -->
    <h2>Adicionar Tarefa</h2>
    <form id="addTaskForm">
        <label for="taskName">Nome da Tarefa:</label>
        <input type="text" id="taskName" required>
        <button type="submit">Adicionar Tarefa</button>
    </form>

    <h2>Lista de Tarefas</h2>
    <ul id="taskList"></ul>

    <!-- Formulário para editar uma tarefa -->
    <h2>Editar Tarefa</h2>
    <form id="editTaskForm">
        <label for="editTaskId">ID da Tarefa:</label>
        <input type="number" id="editTaskId" required>
        <label for="editTaskName">Novo Nome da Tarefa:</label>
        <input type="text" id="editTaskName" required>
        <button type="submit">Editar Tarefa</button>
    </form>

    <script>
        const taskList = document.getElementById('taskList');
        const addTaskForm = document.getElementById('addTaskForm');
        const editTaskForm = document.getElementById('editTaskForm');

        // Função para carregar as tarefas
        let url = "http://127.0.0.1:3000"
        async function loadTasks() {
            const response = await fetch(url + '/task');
            const tasks = await response.json();

            taskList.innerHTML = '';
            tasks.forEach(task => {
                const li = document.createElement('li');
                li.textContent = `Nome: ${task.name}`;
                taskList.appendChild(li);
            });
        }

        // Função para adicionar uma nova tarefa
        addTaskForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const taskName = document.getElementById('taskName').value;

            await fetch(url+'/taskAdd', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: taskName })
            });

            loadTasks(); // Recarrega a lista de tarefas
            addTaskForm.reset(); // Limpa o formulário
        });

        // Função para editar uma tarefa
        editTaskForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const taskId = document.getElementById('editTaskId').value;
            const taskName = document.getElementById('editTaskName').value;

            await fetch(url+`/taskUpdate/${taskId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name: taskName })
            });

            loadTasks(); // Recarrega a lista de tarefas
            editTaskForm.reset(); // Limpa o formulário
        });

        // Carrega as tarefas ao iniciar a página
        loadTasks();
    </script>
</body>
</html>